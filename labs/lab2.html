<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Lab 2 | ECE 5160 Fast Robots Labs </title> <meta name="author" content="Jonathan Ma"> <meta name="description" content="IMU"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/ece5160-labreports/assets/css/bootstrap.min.css?v=a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/ece5160-labreports/assets/css/academicons.min.css?v=f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/ece5160-labreports/assets/css/scholar-icons.css?v=62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/ece5160-labreports/assets/css/jekyll-pygments-themes-github.css?v=591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A4%96&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/ece5160-labreports/assets/css/main.css?v=d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jonathanjma.github.io/ece5160-labreports/labs/lab2.html"> <script src="/ece5160-labreports/assets/js/theme.js?v=48c9b5bd7f2e0605e39e579400e22553"></script> <link defer rel="stylesheet" href="/ece5160-labreports/assets/css/jekyll-pygments-themes-native.css?v=5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/ece5160-labreports/"> ECE 5160 Fast Robots Labs </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/ece5160-labreports/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/ece5160-labreports/labs/">labs <span class="sr-only">(current)</span> </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="fa-solid fa-magnifying-glass"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-half-sun-moon" id="light-toggle-system"></i> <i class="fa-solid fa-moon" id="light-toggle-dark"></i> <i class="fa-solid fa-sun" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Lab 2</h1> <p class="post-description">IMU</p> </header> <article> <h2 id="lab-2">Lab 2</h2> <h3 id="setup">Setup</h3> <p>Using the one of the QWIIC connector wires, I connected the IMU to the Artemis board.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/setup-480.webp 480w,/ece5160-labreports/assets/img/lab2/setup-800.webp 800w,/ece5160-labreports/assets/img/lab2/setup-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/setup.jpeg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>I then ran the basic IMU example program under <code class="language-plaintext highlighter-rouge">File-&gt;Examples-&gt;SparkFun 9DoF IMU Breakout - ICM 20948 - Arduino Library-&gt;Arduino-&gt;Example1_Basics</code>, the video below shows the accelorometer and gyroscope values updating as expected as I moved the IMU board! When I tilted the IMU so that its axes were parallel with gravity, I saw that the accelorometer measured the acceleration due to gravity on that axis. And when I rotated the IMU along its axes, I saw that the gyroscope measured the angular movement on that axis.</p> <p>*** insert yt embed</p> <p>To figure out the use of <code class="language-plaintext highlighter-rouge">AD0_VAL</code> constant in the code, I consulted the Sparkfun’s <a href="https://learn.sparkfun.com/tutorials/sparkfun-9dof-imu-icm-20948-breakout-hookup-guide/all#hardware-overview" rel="external nofollow noopener" target="_blank">IMU webpage</a>, which explains what the <code class="language-plaintext highlighter-rouge">ADR</code> jumper on the back of the IMU chip does. By default, the jumper is open, and the I2C address of the IMU is 0x69. But when the jumper is closed the IMU’s address is 0x68. So the constant in the code tells the library which address the IMU is at, and should be the default value of 1 since the jumper is open.</p> <h3 id="accelorometer">Accelorometer</h3> <p>Next, I started to experiment with the IMU’s accelorometer. Using the following equations from class, I calculated the IMU’s pitch and roll based on measurements from the accelorometer.</p> <p>$\text{Pitch: } \theta_a = \text{atan2}(a_x, a_z)$</p> <p>$\text{Roll: } \phi_a = \text{atan2}(a_y, a_z)$</p> <p>When the IMU is laid flat on the table (z-axis pointing straight up), its pitch and roll is 0.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/pitch_roll_0-480.webp 480w,/ece5160-labreports/assets/img/lab2/pitch_roll_0-800.webp 800w,/ece5160-labreports/assets/img/lab2/pitch_roll_0-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/pitch_roll_0.jpeg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>When the IMU is held vertically such that its x-axis is pointing straight up, we get a pitch of +90. If the x-axis is pointing straight down we get a pitch of -90.</p> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/pitch_pos_90-480.webp 480w,/ece5160-labreports/assets/img/lab2/pitch_pos_90-800.webp 800w,/ece5160-labreports/assets/img/lab2/pitch_pos_90-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/pitch_pos_90.jpeg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/pitch_neg_90-480.webp 480w,/ece5160-labreports/assets/img/lab2/pitch_neg_90-800.webp 800w,/ece5160-labreports/assets/img/lab2/pitch_neg_90-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/pitch_neg_90.jpeg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>When the IMU is held horizontally such that its y-axis is pointing straight up, we get a roll of +90. If the y-axis is pointing straight down we get a roll of -90.</p> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/roll_pos_90-480.webp 480w,/ece5160-labreports/assets/img/lab2/roll_pos_90-800.webp 800w,/ece5160-labreports/assets/img/lab2/roll_pos_90-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/roll_pos_90.jpeg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/roll_pos_90-480.webp 480w,/ece5160-labreports/assets/img/lab2/roll_pos_90-800.webp 800w,/ece5160-labreports/assets/img/lab2/roll_pos_90-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/roll_pos_90.jpeg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>As seen from the images above, the accelorometer readings were highly accurate when I aligned the IMU with the side of my computer (off by at most half a degree). Therefore, I decided that a 2 point calibration would not be needed.</p> <p>Moving the RC car back and forth next to the accelorometer, we see that there is a lot of noise in the pitch and roll data.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/accel_noise-480.webp 480w,/ece5160-labreports/assets/img/lab2/accel_noise-800.webp 800w,/ece5160-labreports/assets/img/lab2/accel_noise-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/accel_noise.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><em>**</em> insert c code</p> <p>The above graph had 500 data points collected with a roughly 10ms gap between each data point. Using that, we can run a Fourier Transform on the data to see what frequencies are causing noise in our data. The images below show a huge spike in the 1-2 Hz range.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/accel_fft-480.webp 480w,/ece5160-labreports/assets/img/lab2/accel_fft-800.webp 800w,/ece5160-labreports/assets/img/lab2/accel_fft-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/accel_fft.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/fft_code-480.webp 480w,/ece5160-labreports/assets/img/lab2/fft_code-800.webp 800w,/ece5160-labreports/assets/img/lab2/fft_code-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/fft_code.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>To implement a low-pass filter, I used the data above to select a cutoff frequency of 3 Hz. This should significantly reduce the amount of noise in the system. For an angle $\theta$, the low pass filter is represented by the following.</p> <p>$\theta_\text{LPF}[n] = \alpha\theta_\text{RAW} + (1 – \alpha)\theta_\text{LPF}[n-1]$</p> <p>To compute $\alpha$, we know that $\alpha = \frac{T}{T + RC}$ and that $RC = \frac{1}{f_c \cdot 2\pi}$</p> <p>So with $f_c = 3$ and $T = 0.01$, we get $RC = 0.053$ and $\alpha = 0.16$</p> <p>*** insert c code</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/accel_lpf-480.webp 480w,/ece5160-labreports/assets/img/lab2/accel_lpf-800.webp 800w,/ece5160-labreports/assets/img/lab2/accel_lpf-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/accel_lpf.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="gyroscope">Gyroscope</h3> <p>Next, I started to experiment with the IMU’s gyroscope. Using the following equations from class, I calculated the IMU’s pitch, roll, and yaw based on measurements from the gyroscope. The pitch and yaw readings are inverted so that they match the axes of the accelorometer.</p> <p>$\text{Pitch: } \theta_g = \theta_g - g_y \cdot dt$</p> <p>$\text{Roll: } \phi_g = \phi_g + g_x \cdot dt$</p> <p>$\text{Yaw: } \psi_g = \psi_g - g_z \cdot dt$</p> <p>remove? ————–</p> <p>As I started collecting data from the gyroscope, I saw that it tended to drift a lot, even while it was sitting still on the table. To attempt to lessen the drift, I collected 500 measurements while the IMU was sitting still and added this as an bias to each gyroscope reading.</p> <div class="row"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/pitch_drift-480.webp 480w,/ece5160-labreports/assets/img/lab2/pitch_drift-800.webp 800w,/ece5160-labreports/assets/img/lab2/pitch_drift-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/pitch_drift.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/yaw_drift-480.webp 480w,/ece5160-labreports/assets/img/lab2/yaw_drift-800.webp 800w,/ece5160-labreports/assets/img/lab2/yaw_drift-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/yaw_drift.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <hr> <p>Looking at the comparison between the biased gyro values the filtered accelorometer values, we can see that the gyro values drift over time and even miss a few of the big movements which were picked up by the accelorometer. However, the gyro also picks up some angles changes quicker then the filtered accelorometer values. So to get the best of both worlds, we can use complimentary angles, which combines both the gyro and accelorometer readings using the following formula:</p> <p>$\theta = (\theta + \theta_g)(1 − \alpha) + \theta_{a_\text{LPF}}\alpha$</p> <p>This works because we high-pass the gyro readings, suppressing the low-frequency drift, while low-passing the accelerometer data, suppressing its noisy readings. The $\alpha$ we use here is the same value as the one we used above to low-pass the accelerometer. As a result, the complimentary angle readings in the graph is accurate and not susceptible to drift or quick vibrations. I also tried adjusting the sampling frequency from 10ms to 50ms but this caused the gyro to drift more and made the complimentary slightly less accurate as a result.</p> <div class="row"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/accel_gyro-480.webp 480w,/ece5160-labreports/assets/img/lab2/accel_gyro-800.webp 800w,/ece5160-labreports/assets/img/lab2/accel_gyro-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/accel_gyro.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab2/yaw-480.webp 480w,/ece5160-labreports/assets/img/lab2/yaw-800.webp 800w,/ece5160-labreports/assets/img/lab2/yaw-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab2/yaw.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="sample-data">Sample Data</h3> <h3 id="stunt">Stunt</h3> </article> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2026 Jonathan Ma. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://github.com/jonathanjma/ece5160-labreports" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/ece5160-labreports/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/ece5160-labreports/assets/js/masonry.js?v=a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/ece5160-labreports/assets/js/zoom.js?v=85ddb88934d28b74e78031fd54cf8308"></script> <script src="/ece5160-labreports/assets/js/no_defer.js?v=2781658a0a2b13ed609542042a859126"></script> <script defer src="/ece5160-labreports/assets/js/common.js?v=c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/ece5160-labreports/assets/js/copy_code.js?v=c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/ece5160-labreports/assets/js/jupyter_new_tab.js?v=d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/ece5160-labreports/assets/js/mathjax-setup.js?v=a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/ece5160-labreports/assets/js/progress-bar.js?v=2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/ece5160-labreports/assets/js/vanilla-back-to-top.min.js?v=f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/ece5160-labreports/assets/js/search/ninja-keys.min.js?v=a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/ece5160-labreports/assets/js/search-setup.js?v=6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/ece5160-labreports/assets/js/search-data.js"></script> <script src="/ece5160-labreports/assets/js/shortcut-key.js?v=ccc841c459bfc0e64c1c2b5acd10df02"></script> </body> </html>