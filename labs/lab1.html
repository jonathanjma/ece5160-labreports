<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Lab 1 | ECE 5160 Fast Robots Labs </title> <meta name="author" content="Jonathan Ma"> <meta name="description" content="Artemis and Bluetooth"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/ece5160-labreports/assets/css/bootstrap.min.css?v=a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/ece5160-labreports/assets/css/academicons.min.css?v=f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/ece5160-labreports/assets/css/scholar-icons.css?v=62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/ece5160-labreports/assets/css/jekyll-pygments-themes-github.css?v=591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A4%96&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/ece5160-labreports/assets/css/main.css?v=d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jonathanjma.github.io/ece5160-labreports/labs/lab1.html"> <script src="/ece5160-labreports/assets/js/theme.js?v=48c9b5bd7f2e0605e39e579400e22553"></script> <link defer rel="stylesheet" href="/ece5160-labreports/assets/css/jekyll-pygments-themes-native.css?v=5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/ece5160-labreports/"> ECE 5160 Fast Robots Labs </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/ece5160-labreports/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/ece5160-labreports/labs/">labs <span class="sr-only">(current)</span> </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="fa-solid fa-magnifying-glass"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-half-sun-moon" id="light-toggle-system"></i> <i class="fa-solid fa-moon" id="light-toggle-dark"></i> <i class="fa-solid fa-sun" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Lab 1</h1> <p class="post-description">Artemis and Bluetooth</p> </header> <article> <h2 id="lab-1a">Lab 1A</h2> <h3 id="setup">Setup</h3> <p>Following the instructions on the lab handout, I was able to latest versions of Arduino IDE and Sparkfun Appollo3 boards manager. However, I soon ran into an issue running the Blink example where my computer was not able to communicate with the Artemis’ bootloader. This was fixed by following the directions to update CH340 driver on my Mac.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/initial_setup-480.webp 480w,/ece5160-labreports/assets/img/lab1/initial_setup-800.webp 800w,/ece5160-labreports/assets/img/lab1/initial_setup-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/initial_setup.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Artemis Board Shows Up in the Arduino IDE! </div> <h3 id="blink">Blink</h3> <p>After running the blink example program under <code class="language-plaintext highlighter-rouge">File-&gt;Examples-&gt;01.Basics-&gt;Blink</code>, the video below shows it working as expected!</p> <iframe width="560" height="315" src="https://www.youtube.com/embed/vkfAYiTNDPk?si=B3hR1s9mWefxINJr" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe> <h3 id="serial">Serial</h3> <p>After running the serial example program under <code class="language-plaintext highlighter-rouge">File-&gt;Examples-&gt;Apollo3-&gt;Example4_Serial</code>, I was able to get the expected output over the serial line on startup and after echoeing strings.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/serial-480.webp 480w,/ece5160-labreports/assets/img/lab1/serial-800.webp 800w,/ece5160-labreports/assets/img/lab1/serial-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/serial.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="temperature">Temperature</h3> <p>After running the temperature sensor example under <code class="language-plaintext highlighter-rouge">File-&gt;Examples-&gt;Apollo3-&gt;Example2_analogRead</code>, I was able to recieve raw sensor readings from the Artemis’ temperature sensor. The screenshot on the left shows the value of the sensor before I started warming it up and the one on the right shows the value of the sensor after I had held my finger on it for a while.</p> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/temp1-480.webp 480w,/ece5160-labreports/assets/img/lab1/temp1-800.webp 800w,/ece5160-labreports/assets/img/lab1/temp1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/temp1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/temp2-480.webp 480w,/ece5160-labreports/assets/img/lab1/temp2-800.webp 800w,/ece5160-labreports/assets/img/lab1/temp2-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/temp2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="microphone">Microphone</h3> <p>After running the microphone example under <code class="language-plaintext highlighter-rouge">File-&gt;Examples-&gt;PDM-&gt;Example1_MicrophoneOutput</code>, I was able to receive microphone frequency readings from the on-board microphone. The video below shows the microphone’s readings as I whistled.</p> <iframe width="560" height="315" src="https://www.youtube.com/embed/GHye9XGb2pM?si=y1pCQCg8UTtR7v2f" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe> <h3 id="5000-level-tuner">(5000 Level) Tuner</h3> <p>To create my simple tuner, I added a few if statements after the line in the example where the loudest frequency is printed. This code should be able to detect the notes middle C, middle F, and middle A# as long as they are played +/- 10 units from the reference frequencies in the code. In the video below, this was tested using an app which generated the sounds for these notes.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">float</span> <span class="n">middle_c</span> <span class="o">=</span> <span class="mi">526</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">middle_f</span> <span class="o">=</span> <span class="mi">698</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">middle_a_sharp</span> <span class="o">=</span> <span class="mi">926</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">ui32LoudestFrequency</span> <span class="o">-</span> <span class="n">middle_c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"Note detected: Middle C</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">ui32LoudestFrequency</span> <span class="o">-</span> <span class="n">middle_f</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"Note detected: Middle F</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">ui32LoudestFrequency</span> <span class="o">-</span> <span class="n">middle_a_sharp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
<span class="n">Serial</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s">"Note detected: Middle A Sharp</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <iframe width="560" height="315" src="https://www.youtube.com/embed/cBvwQnpaSKs?si=HvQFE2R3wJS5ts-A" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe> <h2 id="lab-1b">Lab 1B</h2> <h3 id="prelab">Prelab</h3> <p>Following the instructions in the handout, I was able to get the MAC address of my Artemis board and generate a new UUID for the Bluetooth Low Energy service, which is shown in the images below. Now, when I run the connect function in the Jupyter notebook, the library should be able to find/connect to my own Artemis board and update/receive characteristics.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/mac_address-480.webp 480w,/ece5160-labreports/assets/img/lab1/mac_address-800.webp 800w,/ece5160-labreports/assets/img/lab1/mac_address-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/mac_address.png" class="img-fluid rounded z-depth-1" width="70%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/mac_uuid-480.webp 480w,/ece5160-labreports/assets/img/lab1/mac_uuid-800.webp 800w,/ece5160-labreports/assets/img/lab1/mac_uuid-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/mac_uuid.png" class="img-fluid rounded z-depth-1" width="70%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="task-1">Task 1</h3> <p>To support the <code class="language-plaintext highlighter-rouge">ECHO</code> command, I added the following C code to the switch statement in the <code class="language-plaintext highlighter-rouge">handle_command()</code> function to extract the string from the command and write it to the string characteristic. The image shows that the board successfully echoes the string <code class="language-plaintext highlighter-rouge">Hello from my Mac!</code>.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">ECHO</span><span class="p">:</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">char_arr</span><span class="p">[</span><span class="n">MAX_MSG_SIZE</span><span class="p">];</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">robot_cmd</span><span class="p">.</span><span class="n">get_next_value</span><span class="p">(</span><span class="n">char_arr</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"Echo: "</span><span class="p">);</span>
    <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">char_arr</span><span class="p">);</span>
    <span class="n">tx_characteristic_string</span><span class="p">.</span><span class="n">writeValue</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Sent back: "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/task1-480.webp 480w,/ece5160-labreports/assets/img/lab1/task1-800.webp 800w,/ece5160-labreports/assets/img/lab1/task1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/task1.png" class="img-fluid rounded z-depth-1" width="70%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="task-2">Task 2</h3> <p>To support the <code class="language-plaintext highlighter-rouge">SEND_THREE_FLOATS</code> command, I added the following C code which extracts 3 floats from the commands and prints them to the serial. The images show the 3 floats which are sent from the Jupyter notebook and the serial output after they are processed by the Artemis.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">SEND_THREE_FLOATS</span><span class="p">:</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">;</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">robot_cmd</span><span class="p">.</span><span class="n">get_next_value</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">robot_cmd</span><span class="p">.</span><span class="n">get_next_value</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="n">success</span> <span class="o">=</span> <span class="n">robot_cmd</span><span class="p">.</span><span class="n">get_next_value</span><span class="p">(</span><span class="n">f3</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Three Floats: "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">", "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">f3</span><span class="p">);;</span>

    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/task2_cmd-480.webp 480w,/ece5160-labreports/assets/img/lab1/task2_cmd-800.webp 800w,/ece5160-labreports/assets/img/lab1/task2_cmd-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/task2_cmd.png" class="img-fluid rounded z-depth-1" width="70%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/task2_resp-480.webp 480w,/ece5160-labreports/assets/img/lab1/task2_resp-800.webp 800w,/ece5160-labreports/assets/img/lab1/task2_resp-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/task2_resp.png" class="img-fluid rounded z-depth-1" width="70%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="task-3">Task 3</h3> <p>To support the <code class="language-plaintext highlighter-rouge">GET_TIME_MILLIS</code> command, I added the following C code which calls the <code class="language-plaintext highlighter-rouge">millis()</code> function and write it to the string characteristic. This code is tested in Task 4.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">GET_TIME_MILLIS</span><span class="p">:</span> <span class="p">{</span>
    <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"T:"</span><span class="p">);</span>
    <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">millis</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
    <span class="n">tx_characteristic_string</span><span class="p">.</span><span class="n">writeValue</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Sent back: "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="task-4">Task 4</h3> <p>The image below shows the notification handler I created to recieve the string characteristic generated by sending the <code class="language-plaintext highlighter-rouge">GET_TIME_MILLIS</code> command.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/task4-480.webp 480w,/ece5160-labreports/assets/img/lab1/task4-800.webp 800w,/ece5160-labreports/assets/img/lab1/task4-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/task4.png" class="img-fluid rounded z-depth-1" width="70%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="task-5">Task 5</h3> <p>To conduct this test, I created a new <code class="language-plaintext highlighter-rouge">TIME_LOOP</code> command which attempts write as many values to the string characteristic as possible in a one seconds period. And based on that, it calculates the bytes for second. The images show the output of sending this command. Over the 1 second period, the Artemis sent 112 packets, each of which was 8 bytes long, giving a bytes per second of 896.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">TIME_LOOP</span><span class="p">:</span> <span class="p">{</span>

    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 1 seconds</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"T:"</span><span class="p">);</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">millis</span><span class="p">()).</span><span class="n">c_str</span><span class="p">());</span>
        <span class="n">tx_characteristic_string</span><span class="p">.</span><span class="n">writeValue</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Sent back: "</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
        <span class="n">count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
    <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"bps:"</span><span class="p">);</span>
    <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">count</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span><span class="o">/</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// each message is 8 bytes</span>
    <span class="n">tx_characteristic_string</span><span class="p">.</span><span class="n">writeValue</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Sent back: "</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/task5_start-480.webp 480w,/ece5160-labreports/assets/img/lab1/task5_start-800.webp 800w,/ece5160-labreports/assets/img/lab1/task5_start-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/task5_start.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/task5_bps-480.webp 480w,/ece5160-labreports/assets/img/lab1/task5_bps-800.webp 800w,/ece5160-labreports/assets/img/lab1/task5_bps-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/task5_bps.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="task-6">Task 6</h3> <p>To support the <code class="language-plaintext highlighter-rouge">SEND_TIME_DATA</code> command, I added the following C code which iterates through the globally defined <code class="language-plaintext highlighter-rouge">millis_data</code> array for <code class="language-plaintext highlighter-rouge">DATA_POINTS</code> iterations, which is defined to be 30. After that, it writes all of these timestamps to the string characteristic one after another, which are recieved by the notification handler as shown in the image.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">SEND_TIME_DATA</span><span class="p">:</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">DATA_POINTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">millis_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">DATA_POINTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"T:"</span><span class="p">);</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">millis_data</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">c_str</span><span class="p">());</span>
        <span class="n">tx_characteristic_string</span><span class="p">.</span><span class="n">writeValue</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Sent back: "</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/task6-480.webp 480w,/ece5160-labreports/assets/img/lab1/task6-800.webp 800w,/ece5160-labreports/assets/img/lab1/task6-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/task6.png" class="img-fluid rounded z-depth-1" width="50%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="task-7">Task 7</h3> <p>To support the <code class="language-plaintext highlighter-rouge">GET_TEMP_READINGS</code> command, I added the following C code which iterates through the globally defined <code class="language-plaintext highlighter-rouge">millis_data</code> and <code class="language-plaintext highlighter-rouge">temp_data</code> arrays for 30 iterations. After that, it writes all of the data to the string characteristic one after another, which are parsed by the notification handler into two lists as shown in the image.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="n">GET_TEMP_READINGS</span><span class="p">:</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">DATA_POINTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">millis_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
        <span class="n">temp_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">getTempDegF</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">DATA_POINTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">"T:"</span><span class="p">);</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">millis_data</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">c_str</span><span class="p">());</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">" F:"</span><span class="p">);</span>
        <span class="n">tx_estring_value</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="n">tx_characteristic_string</span><span class="p">.</span><span class="n">writeValue</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>

        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Sent back: "</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">tx_estring_value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/task7-480.webp 480w,/ece5160-labreports/assets/img/lab1/task7-800.webp 800w,/ece5160-labreports/assets/img/lab1/task7-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/task7.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="task-8">Task 8</h3> <p>The differences between collecting and sending each data point one at a time and seperating the collection and sending into 2 loops are huge. The first method is slow for sending large streams of data which are collected every loop and could lead to data loss while sending each packet, but could work for slow streams of data which are only updated once in a while. The second method would be preferred for sending large streams of data without data loss, but takes a lot more memory and is less real time since all the data is collected before it is sent.</p> <p>To test the second method, I used the <code class="language-plaintext highlighter-rouge">SEND_TIME_DATA</code> command and increased the number of datapoints to 100. Looking at the data, I saw that the timestamp of the first packet is 41918 and the 100th packet is 41920. This means that 100 data points are collected in 2ms, so the data resolution is 0.02ms. Meanwhile for the first method which we tried in task 5, the timestemp of the first packet is 73611 and the 30th packet is 74600. This means that 30 data points are collected in 989ms, so the data resolution is 33ms.</p> <p>When I upload code to the Artemis, the Arduino IDE says there is approximately 362KB of free RAM. Assuming each data point is a 4 byte (32 bit) integer, we would be able to store around 90k data points before we run out of memory.</p> <h3 id="5000-level-task-1">(5000 Level) Task 1</h3> <p>To test the data rate, I used the <code class="language-plaintext highlighter-rouge">ECHO</code> command to test replies between 5 bytes and 125 bytes in 5 byte increments. I then used the notification handler to calculate the time it takes the reply to be recieved and the resulting bytes per second. Minus the outliers, the graph shows a linear increase in the bytes per second as the packet size increases. This suggests that the overhead stays relatively constant. This causes short replies to have a smaller bytes per seconds since the overhead is spread over fewer bytes, whereas for larger replies the overhead is spread over more bytes.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/data_rate_test-480.webp 480w,/ece5160-labreports/assets/img/lab1/data_rate_test-800.webp 800w,/ece5160-labreports/assets/img/lab1/data_rate_test-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/data_rate_test.png" class="img-fluid rounded z-depth-1" width="50%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/data_rate_graph-480.webp 480w,/ece5160-labreports/assets/img/lab1/data_rate_graph-800.webp 800w,/ece5160-labreports/assets/img/lab1/data_rate_graph-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/data_rate_graph.png" class="img-fluid rounded z-depth-1" width="60%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="5000-level-task-2">(5000 Level) Task 2</h3> <p>To test the reliability, I sent <code class="language-plaintext highlighter-rouge">ECHO</code> commands with the maximum packet size allowed by the Bluetooth API, which is 150 bytes. I sent 99 of these commands one after another, and all of them were received by my laptop after being echoed by the Artemis.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/ece5160-labreports/assets/img/lab1/reliability_test-480.webp 480w,/ece5160-labreports/assets/img/lab1/reliability_test-800.webp 800w,/ece5160-labreports/assets/img/lab1/reliability_test-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/ece5160-labreports/assets/img/lab1/reliability_test.png" class="img-fluid rounded z-depth-1" width="60%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="discussion">Discussion</h2> <p>Through this lab I learned a lot about the basics of the Artemis platform, Bluetooth Low Energy communication, and how to compare different ways of sending information between my laptop and the Artemis. I didn’t run into any major problems besides the CH340 driver issue during initial setup.</p> </article> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2026 Jonathan Ma. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://github.com/jonathanjma/ece5160-labreports" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/ece5160-labreports/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/ece5160-labreports/assets/js/masonry.js?v=a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/ece5160-labreports/assets/js/zoom.js?v=85ddb88934d28b74e78031fd54cf8308"></script> <script src="/ece5160-labreports/assets/js/no_defer.js?v=2781658a0a2b13ed609542042a859126"></script> <script defer src="/ece5160-labreports/assets/js/common.js?v=c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/ece5160-labreports/assets/js/copy_code.js?v=c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/ece5160-labreports/assets/js/jupyter_new_tab.js?v=d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/ece5160-labreports/assets/js/mathjax-setup.js?v=a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/ece5160-labreports/assets/js/progress-bar.js?v=2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/ece5160-labreports/assets/js/vanilla-back-to-top.min.js?v=f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/ece5160-labreports/assets/js/search/ninja-keys.min.js?v=a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/ece5160-labreports/assets/js/search-setup.js?v=6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/ece5160-labreports/assets/js/search-data.js"></script> <script src="/ece5160-labreports/assets/js/shortcut-key.js?v=ccc841c459bfc0e64c1c2b5acd10df02"></script> </body> </html>